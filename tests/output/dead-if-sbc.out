// IMP-KAT Tests
// =============

// This is a simple testing harness driven by the `tangle` script. Call
// `./tangle test` in the root directory to run the test-set.

// SBC
// ---

// Here, we compile each program into a simpler set of rules specific to that
// program. Compilation must be run with `--search` so that when the state of
// symbolic execution splits at branch points (eg. `if(_)_else_` in IMP) we collect
// rules for both branches.

// ### Dead `if`

// Because we are compiling using symbolic execution, we will often know if a
// branch is dead (only ever evaluates to `true`/`false`). In the `dead-if`
// program, the condition on the `if` is always true, so our rule summary only
// generates a single rule corresponding to the true branch of the `if`. Once
// again, because we are using symbolic execution of the operational semantics
// directly, we get this branch elimination for free.


<kat-imp>
 <s> #STUCK ~> #compile-result ( .Rules
                               , < { int x , .Ids ; x = 7 ; if ( x <= 7 ) { x = 1 ; } else { x = -1 ; } | .Map } --> { . | x |-> 1 } >
                               ) </s>
 <kat>
  <analysis> .Analysis </analysis>
  <states> .States </states>
 </kat>
 <imp>
  <k> . </k>
  <mem> x |-> V0 </mem>
 </imp>
</kat-imp>

